{
  "$schema": "http://json-schema.org/draft-07/schema",
  "$id": "https://json-schema.sodaru.com/@somod/serverless-schema/schemas/components/expression.json",
  "title": "JSON Schema for Expression in Serverless Template by Sodaru Technologies",
  "definitions": {
    "string": { "type": "string" },
    "number": { "type": "number" },
    "boolean": { "type": "boolean" },
    "moduleName": {
      "type": "string",
      "pattern": "^(@[a-z0-9-]+\\/)?[a-z0-9-]+$",
      "maxLength": 128
    },
    "resourceLogicalId": {
      "type": "string",
      "pattern": "^[a-zA-Z0-9]{1,64}$"
    },
    "slpResourceName": {
      "type": "object",
      "additionalProperties": false,
      "required": ["SLP::ResourceName"],
      "properties": {
        "SLP::ResourceName": {
          "type": "string",
          "pattern": "^[a-zA-Z]+[a-zA-Z0-9]*$",
          "maxLength": 64
        }
      }
    },
    "slpRef": {
      "type": "object",
      "additionalProperties": false,
      "required": ["SLP::Ref"],
      "properties": {
        "SLP::Ref": {
          "type": "object",
          "additionalProperties": false,
          "required": ["resource"],
          "properties": {
            "resource": { "$ref": "#/definitions/resourceLogicalId" },
            "module": { "$ref": "#/definitions/moduleName" },
            "attribute": { "type": "string", "pattern": "^[a-zA-Z0-9]+$" }
          }
        }
      }
    },
    "slpParameter": {
      "type": "object",
      "additionalProperties": false,
      "required": ["SLP::Parameter"],
      "properties": {
        "SLP::Parameter": {
          "type": "string",
          "description": "Must refer the parameter available for this module"
        }
      }
    },
    "slpRefResourceName": {
      "type": "object",
      "additionalProperties": false,
      "required": ["SLP::RefResourceName"],
      "properties": {
        "SLP::RefResourceName": {
          "type": "object",
          "additionalProperties": false,
          "required": ["resource", "property"],
          "properties": {
            "resource": { "$ref": "#/definitions/resourceLogicalId" },
            "property": {
              "type": "string",
              "pattern": "^[a-zA-Z]+[a-zA-Z0-9]*$"
            },
            "module": { "$ref": "#/definitions/moduleName" }
          }
        }
      }
    },
    "slpModuleName": {
      "type": "object",
      "additionalProperties": false,
      "required": ["SLP::ModuleName"],
      "properties": {
        "SLP::ModuleName": {
          "type": "string"
        }
      }
    },
    "stringLike": {
      "oneOf": [
        { "$ref": "#/definitions/string" },
        { "$ref": "#/definitions/base64" },
        { "$ref": "#/definitions/if" },
        { "$ref": "#/definitions/findInMap" },
        { "$ref": "#/definitions/join" },
        { "$ref": "#/definitions/select" },
        { "$ref": "#/definitions/sub" },
        { "$ref": "#/definitions/findInMap" },
        { "$ref": "#/definitions/ref" },
        { "$ref": "#/definitions/slpRef" },
        { "$ref": "#/definitions/slpParameter" },
        { "$ref": "#/definitions/slpRefResourceName" },
        { "$ref": "#/definitions/slpModuleName" }
      ]
    },
    "booleanLike": {
      "oneOf": [
        { "$ref": "#/definitions/boolean" },
        { "$ref": "#/definitions/and" },
        { "$ref": "#/definitions/or" },
        { "$ref": "#/definitions/equals" },
        { "$ref": "#/definitions/not" },
        { "$ref": "#/definitions/if" },
        { "$ref": "#/definitions/findInMap" },
        { "$ref": "#/definitions/ref" },
        { "$ref": "#/definitions/slpRef" },
        { "$ref": "#/definitions/slpParameter" }
      ]
    },
    "numberLike": {
      "oneOf": [
        { "$ref": "#/definitions/number" },
        { "$ref": "#/definitions/select" },
        { "$ref": "#/definitions/if" },
        { "$ref": "#/definitions/findInMap" },
        { "$ref": "#/definitions/ref" },
        { "$ref": "#/definitions/slpRef" },
        { "$ref": "#/definitions/slpParameter" }
      ]
    },
    "arrayLike": {
      "oneOf": [
        { "$ref": "#/definitions/cidr" },
        { "$ref": "#/definitions/getAZs" },
        { "$ref": "#/definitions/split" },
        { "$ref": "#/definitions/if" },
        { "$ref": "#/definitions/findInMap" },
        { "$ref": "#/definitions/ref" },
        { "$ref": "#/definitions/slpRef" },
        { "$ref": "#/definitions/slpParameter" }
      ]
    },
    "base64": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "Fn::Base64": { "$ref": "#/definitions/stringLike" }
      }
    },
    "cidr": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "Fn::Cidr": {
          "type": "array",
          "items": [
            { "$ref": "#/definitions/stringLike", "description": "ipBlock" },
            { "$ref": "#/definitions/numberLike", "description": "count" },
            { "$ref": "#/definitions/numberLike", "description": "cidrBits" }
          ],
          "minItems": 3,
          "maxItems": 3,
          "additionalItems": false
        }
      }
    },
    "and": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "Fn::And": {
          "type": "array",
          "items": { "$ref": "#/definitions/booleanLike" },
          "minItems": 1,
          "maxItems": 10
        }
      }
    },
    "or": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "Fn::Or": {
          "type": "array",
          "items": { "$ref": "#/definitions/booleanLike" },
          "minItems": 1,
          "maxItems": 10
        }
      }
    },
    "equals": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "Fn::Equals": {
          "type": "array",
          "items": [
            {
              "anyOf": [
                { "$ref": "#/definitions/stringLike" },
                { "$ref": "#/definitions/numberLike" },
                { "$ref": "#/definitions/booleanLike" },
                { "$ref": "#/definitions/arrayLike" }
              ]
            },
            {
              "anyOf": [
                { "$ref": "#/definitions/stringLike" },
                { "$ref": "#/definitions/numberLike" },
                { "$ref": "#/definitions/booleanLike" },
                { "$ref": "#/definitions/arrayLike" }
              ]
            }
          ],
          "maxItems": 2,
          "minItems": 2,
          "additionalItems": false
        }
      }
    },
    "if": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "Fn::If": {
          "type": "array",
          "items": [
            { "$ref": "#/definitions/string" },
            {
              "anyOf": [
                { "$ref": "#/definitions/stringLike" },
                { "$ref": "#/definitions/numberLike" },
                { "$ref": "#/definitions/booleanLike" },
                { "$ref": "#/definitions/arrayLike" }
              ]
            },
            {
              "anyOf": [
                { "$ref": "#/definitions/stringLike" },
                { "$ref": "#/definitions/numberLike" },
                { "$ref": "#/definitions/booleanLike" },
                { "$ref": "#/definitions/arrayLike" }
              ]
            }
          ],
          "maxItems": 3,
          "minItems": 3,
          "additionalItems": false
        }
      }
    },
    "not": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "Fn::Not": {
          "type": "array",
          "items": [{ "$ref": "#/definitions/booleanLike" }],
          "maxItems": 1,
          "minItems": 1,
          "additionalItems": false
        }
      }
    },
    "findInMap": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "Fn::FindInMap": {
          "type": "array",
          "items": [
            { "$ref": "#/definitions/string" },
            { "$ref": "#/definitions/stringLike" },
            { "$ref": "#/definitions/stringLike" }
          ],
          "minItems": 3,
          "maxItems": 3,
          "additionalItems": false
        }
      }
    },
    "getAZs": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "Fn::GetAZs": {
          "oneOf": [
            { "$ref": "#/definitions/string" },
            { "$ref": "#/definitions/slpRef" },
            { "$ref": "#/definitions/slpParameter" }
          ]
        }
      }
    },
    "join": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "Fn::Join": {
          "type": "array",
          "items": [
            { "$ref": "#/definitions/string" },
            {
              "oneOf": [
                {
                  "type": "array",
                  "items": {
                    "anyOf": [
                      { "$ref": "#/definitions/stringLike" },
                      { "$ref": "#/definitions/numberLike" }
                    ]
                  },
                  "minItems": 1
                },
                { "$ref": "#/definitions/getAZs" },
                { "$ref": "#/definitions/if" },
                { "$ref": "#/definitions/split" },
                { "$ref": "#/definitions/select" },
                { "$ref": "#/definitions/ref" },
                { "$ref": "#/definitions/slpRef" },
                { "$ref": "#/definitions/slpParameter" }
              ]
            }
          ],
          "minItems": 2,
          "maxItems": 2,
          "additionalItems": false
        }
      }
    },
    "select": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "Fn::Select": {
          "type": "array",
          "items": [
            {
              "oneOf": [
                { "$ref": "#/definitions/number" },
                { "$ref": "#/definitions/slpParameter" },
                { "$ref": "#/definitions/findInMap" }
              ]
            },
            {
              "oneOf": [
                { "$ref": "#/definitions/findInMap" },
                { "$ref": "#/definitions/getAZs" },
                { "$ref": "#/definitions/if" },
                { "$ref": "#/definitions/split" },
                { "$ref": "#/definitions/ref" },
                { "$ref": "#/definitions/slpRef" },
                { "$ref": "#/definitions/slpParameter" }
              ]
            }
          ],
          "minItems": 2,
          "maxItems": 2,
          "additionalItems": false
        }
      }
    },
    "split": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "Fn::Split": {
          "type": "array",
          "items": [
            { "$ref": "#/definitions/string" },
            {
              "oneOf": [
                { "$ref": "#/definitions/string" },
                { "$ref": "#/definitions/base64" },
                { "$ref": "#/definitions/findInMap" },
                { "$ref": "#/definitions/getAZs" },
                { "$ref": "#/definitions/if" },
                { "$ref": "#/definitions/join" },
                { "$ref": "#/definitions/select" },
                { "$ref": "#/definitions/sub" },
                { "$ref": "#/definitions/ref" },
                { "$ref": "#/definitions/slpRef" },
                { "$ref": "#/definitions/slpParameter" },
                { "$ref": "#/definitions/slpRefResourceName" },
                { "$ref": "#/definitions/slpModuleName" }
              ]
            }
          ],
          "minItems": 2,
          "maxItems": 2,
          "additionalItems": false
        }
      }
    },
    "sub": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "Fn::Sub": {
          "oneOf": [
            { "type": "string", "maxLength": 1024 },
            {
              "type": "array",
              "items": [
                { "$ref": "#/definitions/string" },
                {
                  "type": "object",
                  "additionalProperties": false,
                  "patternProperties": {
                    "^[a-zA-Z0-9]+$": {
                      "oneOf": [
                        { "$ref": "#/definitions/string" },
                        { "$ref": "#/definitions/base64" },
                        { "$ref": "#/definitions/findInMap" },
                        { "$ref": "#/definitions/getAZs" },
                        { "$ref": "#/definitions/if" },
                        { "$ref": "#/definitions/join" },
                        { "$ref": "#/definitions/select" },
                        { "$ref": "#/definitions/ref" },
                        { "$ref": "#/definitions/slpRef" },
                        { "$ref": "#/definitions/slpParameter" },
                        { "$ref": "#/definitions/slpRefResourceName" }
                      ]
                    }
                  }
                }
              ],
              "minItems": 2,
              "maxItems": 2,
              "additionalItems": false
            }
          ]
        }
      }
    },
    "ref": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "Ref": {
          "enum": [
            "AWS::AccountId",
            "AWS::NotificationARNs",
            "AWS::NoValue",
            "AWS::Partition",
            "AWS::Region",
            "AWS::StackId",
            "AWS::StackName",
            "AWS::URLSuffix"
          ]
        }
      }
    }
  }
}
